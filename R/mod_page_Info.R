#' page_Info UI Function
#'
#' @description A shiny Module.
#'
#' @param id,input,output,session Internal parameters for {shiny}.
#'
#' @noRd
#'
#' @importFrom shiny NS tagList
mod_page_Info_ui <- function(id){
  ns <- NS(id)
  tagList(
    bslib::navset_pill_list(
      id = ns("tabset"),
      widths = c(3, 9),
      well = FALSE,

      bslib::nav_panel("Overview", value = "dash",
                       fluidRow(

                         mainPanel(

                           h1(strong(style="color:#005398","Overview")),

                           p("This dashboard provides an aggregated version of the
                             SIPHER Synthetic Population for Individuals in Great Britain 2019-2021.
                             By providing a “digital twin” of the adult population in Great Britain,
                             the SIPHER Synthetic Population supports a wide range of applications across
                             different fields of policy and research. These applications include, for example,
                             simulations of “what if” scenarios through static/dynamic microsimulation models
                             which require high-quality information on individuals and areas at a granular spatial resolution.
                             Capturing key life domains, the dashboard allows for an intuitive exploration of spatial
                             patterns at different layers of geography. The SIPHER Synthetic Population, the dataset underpinning
                             this dashboard is available via the [link coming soon] - subject to the End User Licence Agreement terms and conditions."),

                        p("Key life domains captured in this dashboard include:"),

                        tags$ul(

                          tags$li("Sociodemographic information used  when
                           creating the SIPHER Synthetic Population)"),

                          tags$li("Health & wellbeing"),

                          tags$li("Income & employment"),

                          tags$li("Housing & households"),

                          tags$li("Lifestyle, diet, and nutrition")

                        ),

                        p("You are permitted to use data obtained from this dashboard in your outputs,
                        including reports or presentations. However, please ensure proper acknowledgment. Refer to Citation & Acknowledgements for details."),

                        p("Further information on the ",
                          a("SIPHER Synthetic Population",
                            href="https://www.gla.ac.uk/research/az/sipher/products/syntheticpopulation/",
                            target="_blank"),
                          ". Related resources include a User Guide [coming soon]."),

                        p("Please direct questions or feedback marked 'Synthetic Population dashboard'
                        to sipher@glasgow.ac.uk"),

                         )
                       )
                       ),

      bslib::nav_panel("About the Data", value= "background",

                       fluidRow(

                         mainPanel(

                           h1(strong(style="color:#005398","SIPHER Synthetic Population for Individuals in Great Britain 2019-2021")),

                           div(
                             style = "text-align: center",
                             HTML('<iframe width="514" height="289" src="https://www.youtube.com/embed/CkiORY7GSLc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>')
                           ),

                           p("The conditions in which we are born, grow, live, work, and age are key drivers of health and health
                                       inequalities. To allow for these complex real-world relationships and interdependencies to be explored,
                                       SIPHER has developed an innovative systems science approach. This approach offers a powerful toolbox
                                       which enables researchers and policymakers to explore of diverse policies that shape our health and wellbeing."),

                           p("A key product of this toolbox is the SIPHER Synthetic Population for Individuals in Great Britain 2019-2021.
                                      As a “digital twin” of the adult population in Great Britain, the SIPHER Synthetic Population supports a wide range of applications
                                      which rely on high-quality individual-level data at a granular spatial resolution.
                                      The SIPHER Synthetic Population is available for full independent use."),
                            p("Discover more at: ",
                             a("SIPHER Synthetic Population",
                                 href="https://www.gla.ac.uk/research/az/sipher/products/syntheticpopulation/",
                                 target="_blank")
                             ),


                         ) # main panel
                       ) #fluidRow


      ), # bslib::nav_panel


      bslib::nav_panel("Usage and Interpretation", value = "SyntheticPopNotes",

                fluidRow(

                  mainPanel(

                    h1(strong(style="color:#005398","Interpretation of Results")),

                    p("All data presented here has been obtained through the aggregation
                      of individual-level data from the SIPHER Synthetic Population for Individuals in
                      Great Britain 2019-2021. The SIPHER Synthetic Population for Individuals in Great Britain
                      2019-2021 was created using a spatial microsimulation algorithm (simulated annealing),
                      and via the ",
                      a("Flexible Modelling Framework.",
                        href = "https://eprints.ncrm.ac.uk/id/eprint/3177/",
                        target = "_blank"),
                      "We therefore advise users to treat all data obtained from this dashboard as
                      “model output” from a synthetic dataset."),

                    p("Here, we provide point estimates only and do not cover any
                        uncertainty estimates (e.g., 95% Confidence Intervals). For applications where
                        uncertainty estimates are required, we strongly encourage users to obtain these
                        directly from the underlying SIPHER Synthetic Population for Individuals in Great Britain 2019-2021 dataset."),

                    p("While no uncertainty estimates are provided, it can be assumed that the
                        uncertainty of point estimates is likely to be higher across areas with a
                        smaller population size (e.g., electoral wards) compared to areas with a larger
                        population size (e.g., local authorities). For areas with small
                        population sizes, the uncertainty surrounding point estimates could be high."),

                    h1(strong(style="color:#005398","Disclaimer")),

                    p("All information provided in this dashboard is provided by the SIPHER
                        Consortium on an 'as is' basis, and without any warranty or liability."),

                    p("The creation of the SIPHER Synthetic Population is based on data from the
                        Understanding Society survey. As such, the underlying SIPHER Synthetic
                        Population dataset does not reflect any 'real' individuals. We strongly advise
                        using the original Understanding Society survey datasets wherever this is
                        possible, in particular when seeking to understand associations or causal
                        structures, cross-sectionally or over time for the UK population. If no granular area-level resolution is required, we recommend using the Understanding Society survey dataset."),

                    p("This dashboard captures aggregate-level information only. No information
                        provided would allow the identification of 'real' individuals
                        – either directly or indirectly. No inferences can or should be made
                        about 'real' individuals, including Understanding Society survey respondents,
                        based on the aggregate-level data provided in this dashboard."),


                    h1(strong(style="color:#005398","Geographic boundary definitions")),

                    p("The following boundary definitions were applied throughout:"),

                    tags$ul(

                      tags$li("LSOAs and MSOAs in 2021 boundaries"),

                      tags$li("Electoral Wards in 2022 boundaries"),

                      tags$li("Local Authorities in 2021 boundaries")

                    ),

                    p("All geography look-up and shape files were obtained from Open Geography and
                        are subject to an Open Government License (OGL 3.0). Please see the separate
                        reproducibility pack for further information and link to all utilised files."),


                    h1(strong(style="color:#005398","Dashboard reproducibility Pack")),

                    p("A reproducibility pack has been created for this dashboard. The reproducibility pack contains all aggregate-level data provided in this dashboard, alongside all code which was developed to support functionality.
                      Access reproducibility pack [link coming soon].")

                  ),

                ) # fluid row bracket

      ), # tabpanel bracket

      bslib::nav_panel("Citation and Acknowledgements", value = "citation",

                fluidRow(

                  mainPanel(

                    h1(strong(style="color:#005398","Citation")),

                    p("Citation:
                        Dylan Lewis, Emma Comrie, Andreas Hoehn, David Innes, and Petra Meier, SIPHER Consortium (2024):
                        An R-Shiny dashboard for the SIPHER Synthetic Population for Individuals in
                        Great Britain 2019-2021. DOI: TBD. Data extracted on [DATA, TIME]."),

                    p("In addition, we strongly encourage the incusion of citations for the two key datasets
                      utilised in the creation of this dashboard:"),

                    tags$ul(

                      tags$li("University of Essex, institute for social and economic research. (2022).
                        Understanding society: Waves 1-12, 2009-2021 and harmonised BHPS: Waves 1-18,
                        1991-2009. [Data collection]. 17th edition. UK Data Service. SN: 6614,
                        http://doi.org/10.5255/UKDA-SN-6614-18."),

                      tags$li("[SIPHER Synthetic Population: exact citation available after acceptance]")

                    ),

                    h1(strong(style="color:#005398","Acknowledgements")),

                    p("This research was conducted as part of the Systems Science in Public Health
                        and Health Economics Research - SIPHER Consortium and we thank the whole team
                        for valuable input and discussions that have informed this work. Understanding
                        Society is an initiative funded by the Economic and Social Research Council and
                        various Government Departments, with scientific leadership by the Institute for
                        Social and Economic Research, University of Essex, and survey delivery by the
                        National Centre for Social Research (NatCen) and Verian (formerly Kantar Public)."),

                    h1(strong(style="color:#005398","Funding")),

                    p("This work by the SIPHER Consortium was supported by the UK Prevention Research
                        Partnership (MR/S037578/2), which is funded by the British Heart Foundation,
                        Cancer Research UK, Chief Scientist Office of the Scottish Government Health and
                        Social Care Directorates, Engineering and Physical Sciences Research Council,
                        Economic and Social Research Council, Health and Social Care Research and
                        Development Division (Welsh Government), Medical Research Council, National
                        Institute for Health Research, Natural Environment Research Council, Public
                        Health Agency (Northern Ireland), The Health Foundation and Wellcome."),

                    br(),

                    br(),

                    div(style = "margin: auto; text-align: center",
                        img(src='www/UKPRP_SIPHER_Logo.png', height = "90px", align = "centre")
                    ),

                    br(),

                    br()

                  ),

                ) # fluid row bracket

      )
    )

  )
}

#' page_Info Server Functions
#'
#' @noRd
mod_page_Info_server <- function(id, r){
  moduleServer( id, function(input, output, session){
    ns <- session$ns

    observeEvent(input$tabset, {
      r$info_tab <- input$tabset
    })

    observeEvent(r$info_tab, {
      if(!identical(r$info_tab, input$topBar)){
        #message(paste("change page to", r$info_tab, "from", input$topBar))
        bslib::nav_select(id = "tabset",
                          selected = r$info_tab)
      }
    })

  })
}

## To be copied in the UI
# mod_page_Info_ui("page_Info_1")

## To be copied in the server
# mod_page_Info_server("page_Info_1")
